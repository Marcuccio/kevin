<!doctype html>
<html lang="en">
    <head>
        <title>KEVIN</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" sizes="16x16" href="/kevin/favicon-32x32.png">

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="container">
        <h1>KEVIN</h1>
        <h4>Known Exploited Vulnerabilities Insights</h4>
        <iframe src="https://ghbtns.com/github-btn.html?user=marcuccio&repo=kevin&type=star&count=true&size=small" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe>

        <div class="container">
            <p>As you may already know there exist a curated list of actively exploited vulnerabilities curated by the Cybersecurity & Infrastructure Security Agency (CISA)</p>
            <p>CISA will update this catalog with additional exploited vulnerabilities as they become known, subject to an executive level CISA review and when they satisfy the following thresholds:</p>

            <ul>
                <li>The vulnerability has an assigned Common Vulnerabilities and Exposures (CVE) ID.</li>
                <li>There is reliable evidence that the vulnerability has been actively exploited in the wild.</li>
                <li>There is a clear remediation action for the vulnerability, such as a vendor provided update.</li>
            </ul>

            <blockquote class="blockquote text-center">
                <p class="mb-3">wish there was an easier way to read these. I need to know what they added and if the solution is fixed by a particular patch.</p>
                <footer class="blockquote-footer">Someone on <cite title="Reddit">Reddit</cite></footer>
            </blockquote> 

            <p>You can use this tool to easily verify wether some of you CVE are marked as dangerous!</p>
        </div>
        
        <div class="container mt-5">
            <div class="row">
                <div class="col-lg-4 col-md-12">
                    <div class="container">
                    <!--     
                        CVE-2021-27104
                        CVE-2021-27102 
                    -->
                        <textarea id='cvelist' name="textarea" class="form-control" required
                            style="max-width:200px;height:160px;" placeholder="CVE-2021-27104&#13;&#10;CVE-2021-27102&#13;&#10;..."></textarea>
                        
                        <div class="mt-3">
                            <button id="checkcve" class="btn btn-primary">Check CVE</button>
                            <button id="copyjson" class="btn btn-primary">Copy table as JSON</button>
                        </div>                        
                        
                    </div>
                </div>

                <div class="col-lg-8 col-md-12 mt-md-3 mt-lg-0">
                    <table id="bin-table" class="table table-hover">
                        <thead>
                            <tr>
                                <th>CVE</th>
                                <th>Vulnerability name</th>
                                <th>Short Description</th>
                                <th>kev</th>
                                <th>itw</th>
                                <th>nuclei</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

            </div>
        </div>

        <script type="text/javascript">
        (function () {
        'use strict'

            let cvelist = document.getElementById('cvelist')
            let table   = document.getElementById('bin-table')
            let _clipboard = [];
            
            let nuc = undefined
            let itw = undefined
            let kev, kev_version, kev_date_released, kev_count = undefined;

            Promise.all([
                fetch('nuclei.txt').then(resp => resp.text()),
                fetch('kev.json').then(resp => resp.json()),
                fetch('itw.json').then(resp => resp.json())
            ]).then(([resp_nuclei, resp_kev, resp_inthewild]) => 
            {

                nuc = resp_nuclei.split("\n")
                itw = resp_inthewild
                kev = resp_kev

                kev_version       = resp_kev.catalogVersion
                kev_date_released = resp_kev.dateReleased
                kev_count         = resp_kev.count


                console.log(`[KEV] catalog version is ${kev_version}`);
            })

            function copyAsJsonToClipboard() {
                let json_object = JSON.stringify(_clipboard, undefined, 2)
                let dummy = document.createElement('textarea');
                document.body.appendChild(dummy);
                dummy.value = json_object;
                dummy.select();
                document.execCommand('copy');
                document.body.removeChild(dummy);
            }

            function cves_from_itw(itw) {
              let cves = itw.map(x => x.id);
              return cves;
            }

            function cves_from_kev(vuln) {
              let cves = vuln.map(x => x.cveID);
              return cves;
            }

            function find_kev_by_id(objects, id) {
                return objects.find(obj => obj.cveID === id);
            }

            function add_cve_knownledge(report, kev, itw, nuc_cve) {
                let itw_cve = cves_from_itw(itw);
                let kev_cve = cves_from_kev(kev.vulnerabilities);

                for (let [key, value] of Object.entries(report)) {
                    value.vuln_name  = "";
                    value.short_desc = "";

                    if (itw_cve.includes(key)) {
                        value.is_itw = true;
                    }
                    if (kev_cve.includes(key)) {
                        value.is_kev = true;
                        
                        let temp = find_kev_by_id(kev.vulnerabilities, key);
                        value.vuln_name = temp.vulnerabilityName;
                        value.short_desc = temp.shortDescription;
                    }
                    if (nuc_cve.includes(key)) {
                        value.is_nuc = true;
                    }
                }

                return report;
            }

            function run(input) {
                _clipboard = [];
                let report = {}; 

                cvelist.value.split('\n').map(el => el.trim()).forEach(key => {
                    report[key] = {
                        "is_kev": false,
                        "is_itw": false,
                        "is_nuc": false,
                    };
                });

                report = add_cve_knownledge(report, kev, itw, nuc);

                while(table.rows.length > 1) {
                  table.deleteRow(1);
                }

                Object.entries(report).map(([k,v]) => {
                    let row = table.insertRow()
                    row.classList.add("align-middle");
                    row.insertCell().innerHTML = k
                    row.insertCell().innerHTML = v.vuln_name
                    row.insertCell().innerHTML = v.short_desc
                    row.insertCell().innerHTML = v.is_kev
                    row.insertCell().innerHTML = v.is_itw
                    row.insertCell().innerHTML = v.is_nuc

                    _clipboard.push(v)
                })
            }

            document.getElementById('copyjson').addEventListener('click', copyAsJsonToClipboard);
            document.getElementById('checkcve').addEventListener('click', run);            
        })()
        </script>
    </body>
</html>