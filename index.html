<!doctype html>
<html lang="en">
    <head>
        <title>KEVIN</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-32x32.png">


        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <script src="https://cdn.anychart.com/releases/8.12.0/js/anychart-base.min.js" type="text/javascript"></script>
        <script src="https://cdn.anychart.com/releases/8.12.0/js/anychart-core.min.js"></script>
        <script src="https://cdn.anychart.com/releases/8.12.0/js/anychart-venn.min.js"></script>
        <link href="style.css" rel="stylesheet">
    </head>
    <body>
        <div class="container">
        <h1>KEVIN</h1>
        <h4>Known Exploited Vulnerabilities Insights</h4>
        <iframe src="https://ghbtns.com/github-btn.html?user=marcuccio&repo=kevin&type=star&count=true&size=small" frameborder="0" scrolling="0" width="170" height="30" title="GitHub"></iframe>

        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-md-12 mt-md-3 mt-lg-0">
                    <div class="container">
                        <p class="justify">KEVIN is a powerful tool designed to empower your understanding of Common Vulnerabilities and Exposures (CVEs). With KEVIN, you can effortlessly prioritize CVE data, making informed decisions to enhance your cybersecurity measures. It retrieves valuable information from multiple sources:</p>

                        <ul>
                            <li><a target="_blank" href="https://inthewild.io/">in-the-wild data</a></li>
                            <li><a target="_blank" href="https://www.cisa.gov/known-exploited-vulnerabilities-catalog">CISA KEV catalog</a></li>
                            <li><a target="_blank" href="https://github.com/projectdiscovery/nuclei-templates">Nuclei from Project Discovery</a></li>
                        </ul>


                        <p>You can use this tool to easily verify wether some of your CVEs are marked as dangerous!</p>
                        <p>Simply provide a list of CVEs in the dedicated input field, and KEVIN takes care of the rest. </p>

                    </div>
                </div>

                <div class="col-lg-4 col-md-12">
                    <div class="container">
                    <!--
                        CVE-2021-27104
                        CVE-2021-27102
                    -->
                        <textarea id='cvelist' name="textarea" class="form-control" required
                            style="max-width:250px;height:180px;" placeholder="CVE-2021-27104&#13;&#10;CVE-2021-27102&#13;&#10;..."></textarea>

                        <div class="mt-3">
                            <button id="checkcve" class="btn btn-primary">Check CVE</button>
                            <button id="copyjson" class="btn btn-primary">Copy table as JSON</button>
                        </div>

                    </div>
                </div>

            </div>

            <div class="row">
                <div id="venn_container"></div>
            </div>
        </div>

        <blockquote class="blockquote text-center" style="margin: 36px;">
            <p class="mb-3">wish there was an easier way to read these.</p>
            <footer class="blockquote-footer">Someone on <cite title="Reddit">Reddit</cite></footer>
        </blockquote>

        <div class="container">
            <table id="bin-table" class="table table-hover">
                <thead>
                    <tr>
                        <th>CVE</th>
                        <th>Vulnerability name</th>
                        <th>Short Description</th>
                        <th>kev</th>
                        <th>itw</th>
                        <th>nuclei</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <script type="text/javascript">
        (function () {
        'use strict'

            const cvelist = document.getElementById('cvelist')
            const table   = document.getElementById('bin-table')
            const thead   = table.tHead
            const tbody   = table.tBodies[0]
            let _clipboard = [];

            let nuc, nuc_count = undefined
            let itw, itw_count = undefined
            let kev, kev_version, kev_date_released, kev_count = undefined;

            let kevin_report = undefined;
          
            Promise.all([
                fetch('nuclei.json').then(resp => resp.json()),
                fetch('kev.json').then(resp => resp.json()),
                fetch('itw.json').then(resp => resp.json())
            ]).then(([resp_nuclei, resp_kev, resp_inthewild]) => {

                nuc = resp_nuclei
                nuc_count = resp_nuclei.length

                itw = resp_inthewild
                itw_count = resp_inthewild.length

                kev = resp_kev
                kev_version       = resp_kev.catalogVersion
                kev_date_released = resp_kev.dateReleased
                kev_count         = resp_kev.count

                console.log(`[KEV] catalog version is ${kev_version}`);
            }).then(() => {
                kevin_report = get_kevin_report();
                fill_table(kevin_report);
                draw_venn()
            })

            function copyAsJsonToClipboard() {
                let json_object = JSON.stringify(_clipboard, undefined, 2)
                let dummy = document.createElement('textarea');
                document.body.appendChild(dummy);
                dummy.value = json_object;
                dummy.select();
                document.execCommand('copy');
                document.body.removeChild(dummy);
            }

            function cves_from_nuc() {
              let cves = nuc.map(x => x.ID);
              return cves;
            }

            function cves_from_itw() {
              let cves = itw.map(x => x.id);
              return cves;
            }

            function cves_from_kev() {
              let cves = kev.vulnerabilities.map(x => x.cveID);
              return cves;
            }

            function find_nuc_by_id(objects, id) {
                return objects.find(obj => obj.ID === id);
            }

            function find_kev_by_id(objects, id) {
                return objects.find(obj => obj.cveID === id);
            }
            
            function get_kevin_report() {
                let kevin_report = {}

                let nuc_cve = cves_from_nuc();
                let itw_cve = cves_from_itw();
                let kev_cve = cves_from_kev();
                let combinedCVEs = [...nuc_cve, ...itw_cve, ...kev_cve];
                const uniqueCVEs = new Set(combinedCVEs);
                uniqueCVEs.forEach(key => {

                    let value = {
                        "id": key,
                        "vuln_name": "",
                        "short_desc": "",
                        "is_kev": false,
                        "is_itw": false,
                        "is_nuc": false,
                    };
                    
                    if (itw_cve.includes(key)) {
                        value.is_itw = true;
                    }
                    if (kev_cve.includes(key)) {
                        value.is_kev = true;

                        let temp = find_kev_by_id(kev.vulnerabilities, key);
                        value.vuln_name = temp.vulnerabilityName;
                        value.short_desc = temp.shortDescription;
                    }
                    if (nuc_cve.includes(key)) {
                        value.is_nuc = true;

                        let temp = find_nuc_by_id(nuc, key);
                        value.vuln_name = temp.Info.Name;
                        value.short_desc = temp.Info.Description;
                    }

                    kevin_report[key] = value;

                });

                return kevin_report;
            }

            function fill_table(report) {

                Object.entries(report).map(([k,v]) => {
                    let row = tbody.insertRow()
                    row.classList.add("align-middle");
                    row.insertCell().innerHTML = k
                    row.insertCell().innerHTML = v.vuln_name
                    row.insertCell().innerHTML = v.short_desc

                    let isKevCell = row.insertCell();
                    if (v.is_kev) {isKevCell.style.color = "red";}
                    isKevCell.innerHTML = v.is_kev

                    let isItwCell = row.insertCell();
                    if (v.is_itw) {isItwCell.style.color = "red";}
                    isItwCell.innerHTML = v.is_itw

                    let isNucCell = row.insertCell();
                    if (v.is_nuc) {isNucCell.style.color = "red";}
                    isNucCell.innerHTML = v.is_nuc


                    _clipboard.push(v)
                })

            }

            function filter_cves_but() {

                let cves = cvelist.value.split('\n').map(el => el.trim())

                if (cves.length === 0) {
                    
                    Array.from(tbody.rows).forEach(row => {
                        row.style.display = '';
                    });

                } else {

                    Array.from(tbody.rows).forEach(row => {
                        // Get the cell content (assuming the CVE is in the first cell)
                        const cellContent = row.cells[0].textContent;

                        // Check if the CVE is in the provided array
                        const isInArray = cves.includes(cellContent);

                        // Toggle row visibility based on array inclusion
                        row.style.display = isInArray ? '' : 'none';
                    });
                }

            }

            function draw_venn() {

                let nuc_cve = cves_from_nuc();
                let itw_cve = cves_from_itw();
                let kev_cve = cves_from_kev();
                
                var data = [
                {x: "Kev", value: kev_count},
                {x: "ITW", value: itw_count},
                {x: "Nuclei", value: nuc_count},
                {x: ["Kev", "ITW"], value: kev_cve.filter(x => itw_cve.includes(x)).length},
                {x: ["Kev", "Nuclei"], value: kev_cve.filter(x => nuc_cve.includes(x)).length},
                {x: ["ITW", "Nuclei"], value: itw_cve.filter(x => nuc_cve.includes(x)).length}
            ];

                // create a chart and set the data
                let chart = anychart.venn(data);

                // configure labels of intersections
                chart.intersections().labels().format("{%x}");

                // set the container id
                chart.container('venn_container');

                // initiate drawing the chart
                chart.draw();
            }

            const headerCells = thead.rows[0].cells;

            for (const th of headerCells) {
                const cellIndex = th.cellIndex;

                th.addEventListener("click", () => {
                    const rows = Array.from(tbody.rows);

                    while(tbody.rows.length > 0) {
                        tbody.deleteRow(-1);
                    }

                    rows.sort((tr1, tr2) => {
                        const tr1Text = tr1.cells[cellIndex].textContent;
                        const tr2Text = tr2.cells[cellIndex].textContent;
                        return tr1Text.localeCompare(tr2Text)*-1;
                    });

                    tbody.append(...rows);
                });
            }

            document.getElementById('copyjson').addEventListener('click', copyAsJsonToClipboard);
            document.getElementById('checkcve').addEventListener('click', filter_cves_but);

        })()
        </script>
    </body>
</html>